define(["jquery","core/str","core/notification","core/ajax"],(function(e,t,n,o){return{init:function(){e(".su-agent-copy").off("click").on("click",(function(e){e.preventDefault();const o=function(e){return new Promise((function(t,n){const o=document.createElement("textarea");o.value=e,o.style.position="fixed",o.style.left="-999999px",o.style.top="-999999px",document.body.appendChild(o),o.focus(),o.select();try{const e=document.execCommand("copy");document.body.removeChild(o),e?t():n(new Error("Copy command failed"))}catch(e){document.body.removeChild(o),n(e)}}))};Promise.all([t.get_string("date","block_su_agent_moodle"),t.get_string("server","block_su_agent_moodle"),t.get_string("identification","block_su_agent_moodle"),t.get_string("configuration","block_su_agent_moodle")]).then((function([e,n,r,c]){const i=document.getElementById("serverlabel").querySelector("strong").textContent,l=document.getElementById("identificationlabel").querySelector("strong").textContent,a=document.getElementById("ipaddresslabel").querySelector("strong").textContent,s=document.getElementById("configurationlabel").querySelector("i").textContent,d=document.getElementById("datelabel").querySelector("strong").textContent;return(u=e+" : "+d+" | "+n+" : "+i+" | "+r+" : "+l+" => "+a+" | "+c+" : "+s,navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(u).then((function(){return Promise.resolve()})).catch((function(e){return console.warn("Clipboard API failed, trying fallback:",e),o(u)})):o(u)).then((function(){return t.get_string("msgalertgood","block_su_agent_moodle")})).then((function(e){alert(e)}));var u})).catch((function(e){console.error("Copy operation failed:",e),t.get_string("msgalertbadbrowser","block_su_agent_moodle").then((function(e){alert(e)})).fail(n.exception)}))})),e(".su-agent-send").off("click").on("click",(function(){const r=e(".su-agent-message").val().trim();if(!r)return void t.get_string("msgempty","block_su_agent_moodle").then((function(e){alert(e)})).fail(n.exception);const c={message:r,server:document.getElementById("serverlabel").querySelector("strong").textContent,identification:document.getElementById("identificationlabel").querySelector("strong").textContent,ipaddress:document.getElementById("ipaddresslabel").querySelector("strong").textContent,configuration:document.getElementById("configurationlabel").querySelector("i").textContent,date:document.getElementById("datelabel").querySelector("strong").textContent};o.call([{methodname:"block_su_agent_moodle_send_mail",args:c}])[0].then((function(){t.get_string("msgemailsuccess","block_su_agent_moodle").then((function(t){n.addNotification({message:t,type:"success"}),e(".su-agent-message").val("")})).fail(n.exception)})).catch((function(){t.get_string("error","block_su_agent_moodle").then((function(e){n.addNotification({message:e,type:"error"})})).fail(n.exception)}))}))}}}));
