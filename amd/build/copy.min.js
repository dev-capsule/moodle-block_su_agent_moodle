define(["jquery","core/str","core/notification","core/ajax"],function(e,t,n,o){return{init:function(){e(".su-agent-copy").off("click").on("click",function(e){if(e.preventDefault(),!navigator.clipboard){t.get_string("msgalertbadbrowser","block_su_agent_moodle").then(function(e){alert(e)}).fail(n.exception);return}Promise.all([t.get_string("date","block_su_agent_moodle"),t.get_string("server","block_su_agent_moodle"),t.get_string("identification","block_su_agent_moodle"),t.get_string("configuration","block_su_agent_moodle")]).then(function([e,n,o,l]){let i={serverlabel:document.getElementById("serverlabel").querySelector("strong").textContent,identificationlabel:document.getElementById("identificationlabel").querySelector("strong").textContent,ipaddresslabel:document.getElementById("ipaddresslabel").querySelector("strong").textContent,configurationlabel:document.getElementById("configurationlabel").querySelector("i").textContent,datelabel:document.getElementById("datelabel").querySelector("strong").textContent},r=e+" : "+i.datelabel+" | "+n+" : "+i.serverlabel+" | "+o+" : "+i.identificationlabel+" => "+i.ipaddresslabel+" | "+l+" : "+i.configurationlabel;return navigator.clipboard.writeText(r).then(function(){return t.get_string("msgalertgood","block_su_agent_moodle")}).then(function(e){alert(e)})}).catch(function(){t.get_string("error","block_su_agent_moodle").then(function(e){alert(e)}).fail(n.exception)})}),e(".su-agent-send").off("click").on("click",function(){let l=e(".su-agent-message").val().trim();if(!l){t.get_string("msgempty","block_su_agent_moodle").then(function(e){alert(e)}).fail(n.exception);return}let i={message:l,server:document.getElementById("serverlabel").querySelector("strong").textContent,identification:document.getElementById("identificationlabel").querySelector("strong").textContent,ipaddress:document.getElementById("ipaddresslabel").querySelector("strong").textContent,configuration:document.getElementById("configurationlabel").querySelector("i").textContent,date:document.getElementById("datelabel").querySelector("strong").textContent};o.call([{methodname:"block_su_agent_moodle_send_mail",args:i}])[0].then(function(){t.get_string("msgemailsuccess","block_su_agent_moodle").then(function(t){n.addNotification({message:t,type:"success"}),e(".su-agent-message").val("")}).fail(n.exception)}).catch(function(){t.get_string("error","block_su_agent_moodle").then(function(e){n.addNotification({message:e,type:"error"})}).fail(n.exception)})})}}});
